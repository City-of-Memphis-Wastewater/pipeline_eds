# Use a slim Python 3.11 base image to keep the container small.
FROM python:3.11-slim

# Set the working directory inside the container.
WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y bash curl \
    && rm -rf /var/lib/apt/lists/*

# Install uv directly 
COPY --from=ghcr.io/astral-sh/uv:latest /uv /uvx /bin/

# Copy the project files
COPY . .

# Install dependencies using uv sync
# --frozen ensures uv.lock is used exactly
# --no-dev keeps the image small
RUN uv sync --frozen --no-dev

# Expose any ports your application might need (e.g., for the Plotly web server).
EXPOSE 8000

# Set the entry point for the container.
# This defines the command that will run when the container starts.
# It uses the "eds" alias from your pyproject.toml file.
ENTRYPOINT ["uv", "run", "eds"]

# Optional: allow overriding with interactive bash
# Usage: docker run -it --rm --entrypoint bash pipeline-eds
CMD ["--help"]

# Make the container available as a GitHub Package
LABEL org.opencontainers.image.source https://github.com/city-of-memphis-wastewater/pipeline_eds